---
title: æ–æ³¢é‚£å¥‘æ•°åˆ—æ€§è´¨çš„ä¸€é“é¢˜
mathjax: true
categories: ç®—æ³•
tags:
  - æ–æ³¢é‚£å¥‘æ•°åˆ—
  - æ•°è®º
abbrlink: ae2873a
date: 2024-11-13 22:26:37
---


# è®°å½•ä¸€é“æ–æ³¢é‚£å¥‘æ•°åˆ—çš„ç®—æ³•é¢˜

[->åŸé¢˜é“¾æ¥è§è¿™é‡Œ<-](https://codeforces.com/contest/2033/problem/F) 


æ³¨ï¼šæ„Ÿè°¢**åŒæµ21çº§æ•°æ‹” æˆ´å…ˆç”Ÿ**å¯¹ä¸€äº›æ•°å­¦è¯æ˜çš„è§£ç­”ï¼Œä½¿æœ¬äººå‡­å€Ÿå¾®å¼±çš„æ•°å­¦åŸºç¡€ä¹Ÿèƒ½å®Œæˆæœ¬æ–‡çš„ä¹¦å†™ğŸ¥°

## åŸé¢˜é‡è¿°

é¢˜æ„ç®€è¿°ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ç»å…¸çš„æ–æ³¢é‚£å¥‘æ•°åˆ—æ»¡è¶³å¦‚ä¸‹æ€§è´¨ï¼š

$$
\begin{align}
f(1)&=f(2)=1\\
f(n)&=f(n-1)+f(n-2)\quad where\quad 3\leq n ;
\end{align}
$$

æˆ‘ä»¬è®°å½•å¯¹äºæ–æ³¢é‚£å¥‘æ•°åˆ—$f$ç¬¬nä¸ªå¯ä»¥æ•´é™¤kçš„ä¸‹æ ‡~~ä»1å¼€å§‹~~ä¸º$G{(n,k)}$ï¼Œå› ä¸º$G(n,k)$å¯èƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥è¾“å‡ºæ—¶å€™æˆ‘ä»¬ä¼šå°†ç»“æœ$mod(10^9+7)$.

## solve the problem

æ ¹æ®è¡¥å……æ¡ä»¶çš„ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šä¸€ä¸ªå¾ªç¯èŠ‚ï¼Œç„¶ååœ¨å¾ªç¯èŠ‚ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æ•´é™¤çš„ä¸‹æ ‡é—®é¢˜å°±è§£å†³äº†ï¼ˆå…³é”®åœ¨äºPisanoå‘¨æœŸæœ‰å¾ˆå¤šè‰¯å¥½çš„æ€§è´¨æ¥å¸®åŠ©æˆ‘ä»¬è®¾è®¡ä¸€ç³»åˆ—æœ€ä½³ç®—æ³•ï¼Œåç»­èƒŒæ™¯çŸ¥è¯†éå¸¸é‡è¦ï¼‰ï¼›


ä»£ç å¦‚ä¸‹ï¼š
```cpp
#include <bits/stdc++.h>
using namespace std;
using ll=long long;

#define MODN 1000000007


void solver(ll n,ll k){
    if(k==1){
        cout<<n%MODN<<endl;
        return;
    }
    ll max_loop_length=k*k+2;
    ll feb[3];//è®°å½•å±€éƒ¨æ–æ³¢é‚£å¥‘æ•°åˆ—
    feb[0]=1;feb[1]=1;feb[2]=2;
    ll loop_length=0;
    vector<ll> idxs;

    //æ¥ä¸‹æ¥ç¡®è®¤Pisanoå‘¨æœŸçš„é•¿åº¦ï¼
    
    while(max_loop_length-->0)
    {
        if(feb[0]%k==0){
            idxs.push_back(1+loop_length);
        }
        feb[0]=feb[1];feb[1]=feb[2];
        feb[2]=(feb[1]+feb[0])%k;
        
        loop_length++;
        if(feb[0]%k==1&&feb[1]%k==1){
            break;
        }
    }    
    
    ll period_num=n/idxs.size();
    ll period_idx=n%idxs.size();//ç”¨äºè®¡ç®—ç›®çš„ä¸‹æ ‡

    // cout<<"========"<<endl;
    // for(auto i:idxs)cout<<i<<endl;
    // cout<<"========"<<endl;
    // printf("loop length= ");
    // cout<<loop_length<<endl;

    ll ans=0;
    if(period_idx==0){
        ans=((((period_num-1)%MODN)*(loop_length%MODN))%MODN+idxs.at(idxs.size()-1))%MODN;
        
    }else{

        ans=(((period_num%MODN)*(loop_length%MODN))%MODN+idxs.at(period_idx-1))%MODN;
        
    }

    cout<<ans<<endl;//æœ€åæ³¨æ„å–ä½™å’Œé˜²æ­¢æº¢å‡º

}

int main(){
    ll t,k;
    ll n;
    cin>>t;
    for(ll i=0;i<t;i++)
    {
        cin>>n>>k;
        solver(n,k);
    }
    return 0;
}
```

ä¹Ÿæ˜¯é¡ºåˆ©é€šè¿‡äº†ï¼

<center>
<img src="/pics/accfeb.png" width="90%">
</center>

## èƒŒæ™¯çŸ¥è¯†è¡¥å……ï¼š

> What is Pisano Period?

åœ¨æ•°è®ºä¸­né˜¶Pisanoå‘¨æœŸå†™ä½œ$\pi(n)$ï¼Œè¡¨å¾å°†ä¸Šè¿°æ–æ³¢é‚£å¥‘æ•°åˆ—å¯¹nå–æ¨¡ä¹‹åçš„å‘¨æœŸï¼Œè¿™ä¸ªåå­—å–äº[Leonardo Pisano](https://en.wikipedia.org/wiki/Fibonacci). ä¾‹å¦‚æˆ‘ä»¬å¦‚æœè€ƒè™‘$\pi(3)$ï¼Œæˆ‘ä»¬å¯¹æ–æ³¢é‚£å¥‘æ•°åˆ—å¯¹3å–æ¨¡å¯ä»¥å¾—åˆ°ï¼š

<center>
0, 1, 1, 2, 0, 2, 2, 1, 0, 1, 1, 2, 0, 2, 2, 1, 0, 1, 1, 2, 0, 2, 2, 1, 0, ...
</center>

è¿™ä¸ªåºåˆ—æ˜¾ç„¶ä»¥8ä¸ºå‘¨æœŸï¼Œäºæ˜¯$\pi(3)=8$.

### Pisanoå‘¨æœŸçš„å­˜åœ¨æ€§è¯æ˜ï¼š

æˆ‘ä»¬è€ƒè™‘$\pi(p)$ï¼Œè€ƒè™‘æ¨¡$p$æ„ä¹‰ä¸‹çš„æ–æ³¢é‚£å¥‘æ•°åˆ—$f_p:f(m)mod(p)$ï¼›

åŸºäºæ–æ³¢é‚£å¥‘æ•°çš„é€’æ¨æ€§è´¨ï¼šæ¯ä¸€é¡¹éƒ½åªå–å†³äºä»–çš„å‰ä¸¤é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘æ„é€ $\{f_p(i),f_p(i+1)\}$è¿™æ ·çš„æ–æ³¢é‚£å¥‘æ•°å¯¹ï¼›æ„é€ ä»$i=1\to p^2+1$ è¿™$p^2+1$å¯¹ï¼š

$$
\{f_p(1),f_p(2)\},\dots,\{f_p(p^2+1),f_p(p^2+2)\}
$$

æ ¹æ®æŠ½å±‰åŸç†ï¼Œå¿…å®šä¼šæœ‰å®Œå…¨ç›¸ç­‰çš„æ•°å¯¹ï¼ŒåŸºäºè¿™æ ·çš„æ•°å¯¹ä¾¿å¯ä»¥å¾ªç¯ä¸‹å»æ„é€ å‡ºå¾ªç¯èŠ‚ï¼ï¼ï¼è¿™è•´å«äº†**å……è¦æ¡ä»¶**ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è®¾è®¡ç®—æ³•çš„å…³é”®ï¼›



### Pisano Periodçš„ä¸€äº›æ˜¾ç„¶æˆ–è€…ä¸æ˜¾ç„¶çš„æ€§è´¨ï¼š


- é™¤äº†$\pi(2)=3$ä»¥å¤–ï¼ŒPisanoå‘¨æœŸéƒ½æ˜¯å¶æ•°ï¼›ã€è¯æ˜è§é™„å½•proof1ã€‘





- å½“m,näº’è´¨æ—¶ï¼Œç”±ä¸­å›½å‰©ä½™å®šç†å³çŸ¥$\pi(mn)$ç­‰äº$\pi(m)$å’Œ$\pi(n)$çš„æœ€å°å…¬å€æ•°ã€‚ä¾‹å¦‚ï¼ŒÏ€(3) = 8 è€ŒÏ€(4) = 6ï¼Œç”±æ­¤å¯å¾—Ï€(12) = 24. å› æ­¤ï¼Œå¯¹çš®è¨è¯ºå‘¨æœŸçš„ç ”ç©¶å¯ä»¥åŒ–å½’ä¸ºå¯¹ç´ æ•°å¹‚$q = p^k (k â‰¥ 1)$çš„çš®è¨è¯ºå‘¨æœŸçš„ç ”ç©¶ã€‚


- å¯ä»¥è¯æ˜ï¼šå¦‚æœ$p$ä¸ºç´ æ•°é‚£ä¹ˆ$\pi(p^k)$æ•´é™¤$p^{k-1}\pi(p)$ï¼›å¦å¤–æœ‰**çŒœæƒ³**è®¤ä¸º$\pi(p^k)=p^{k-1}\pi(p)$å¯¹ä¸€åˆ‡ç´ æ•°$p$ä»¥åŠæ­£æ•´æ•°$k$æˆç«‹ã€‚ä»»ä½•ä¸æ»¡è¶³è¯¥çŒœæƒ³çš„ç´ æ•°$p$éƒ½å¿…ç„¶æ˜¯ä¸€ä¸ªæ²ƒå°”-å­™-å­™ç´ æ•°[(Wall-Sun-Sun prime)](https://zh.wikipedia.org/wiki/%E6%B2%83%E5%B0%94-%E5%AD%99-%E5%AD%99%E7%B4%A0%E6%95%B0)ï¼Œè€Œè¿™ç§ç´ æ•°è¢«çŒœæƒ³å¹¶ä¸å­˜åœ¨ã€‚


å› æ­¤å¯¹çš®è¨è¯ºå‘¨æœŸçš„ç ”ç©¶å¯ä»¥è¢«è¿›ä¸€æ­¥åŒ–å½’ä¸ºå¯¹ç´ æ•°çš„çš®è¨è¯ºå‘¨æœŸçš„ç ”ç©¶ã€‚

## æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸€äº›æ€§è´¨çš„æ•´ç†å’Œè¯æ˜ï¼š







## Appendix

> ä¸€èˆ¬çº¿æ€§ç¾¤

åœ¨æ•°å­¦ä¸­ï¼Œn æ¬¡ä¸€èˆ¬çº¿æ€§ç¾¤æ˜¯ nÃ—n å¯é€†çŸ©é˜µçš„é›†åˆï¼Œå’Œä¸ä¹‹ä¸€èµ·çš„æ™®é€šçŸ©é˜µä¹˜æ³•è¿ç®—ã€‚è¿™å½¢æˆäº†ä¸€ä¸ªç¾¤ï¼Œå› ä¸ºä¸¤ä¸ªå¯é€†çŸ©é˜µçš„**ä¹˜ç§¯ä¹Ÿæ˜¯å¯é€†çŸ©é˜µ**ï¼Œè€Œ**å¯é€†çŸ©é˜µçš„é€†å…ƒè¿˜æ˜¯å¯é€†çŸ©é˜µ**ã€‚åœ¨ Rï¼ˆå®æ•°é›†ï¼‰ä¸Šçš„ä¸€èˆ¬çº¿æ€§ç¾¤æ˜¯å®æ•°çš„ nÃ—n å¯é€†çŸ©é˜µçš„ç¾¤ï¼Œå¹¶è®°ä½œä¸º$GL_n(\mathcal{R})$.



> proof1

è¿™ä¸ªæ€§è´¨çš„ä¸€ä¸ªç®€çŸ­è¯æ˜ï¼Œè€ƒè™‘æ–æ³¢é‚£å¥‘çŸ©é˜µ:

$$
\begin{align*}
M_{f}&=
\left(
\begin{matrix}
1&1\\
1&0
\end{matrix}
\right)\\
[f(m+1),f(m)]&=[f(m),f(m-1)]M_f
\end{align*}
$$

é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æœ‰ï¼š

$$
\begin{align*}
[f(m+1+\pi(n)),f(m+\pi(n))] &=[f(m+1),f(m)]M_f^{\pi(n)}\quad mod(n)\\
&=[f(m+1),f(m)]\quad mod(n)\\
\end{align*}
$$

æˆ‘ä»¬è®°

$$
M_f^{\pi(n)}mod(n)=
\left(
\begin{matrix}
a&b\\
c&f\\
\end{matrix}
\right)
$$

ä»è€Œæœ‰

$$
[f(m+1),f(m)]\left(
\begin{matrix}
a-1&b\\
c&f-1\\
\end{matrix}
\right)=0
$$

è€ƒè™‘åˆ°$[f(m+1),f(m)]$çš„**ç›¸å¯¹çš„ä»»æ„æ€§**($3\leq k$ï¼Œå¾ªç¯èŠ‚é•¿åº¦å¤§äºç­‰äº3æ„å‘³ç€ä½ å¯ä»¥ä»»é€‰ä¸¤ä¸ªçº¿æ€§æ— å…³å‘é‡)ï¼Œäºæ˜¯æœ‰ï¼š

$$
\left(
\begin{matrix}
a-1&b\\
c&f-1\\
\end{matrix}
\right)=\left(
\begin{matrix}
0&0\\
0&0\\
\end{matrix}
\right)


$$



äºæ˜¯ï¼š

$$
M_f^{\pi(n)}mod(n)=
\left(
\begin{matrix}
1&0\\
0&1\\
\end{matrix}
\right)
$$

ä¸¤è¾¹åŒæ—¶æ¨¡æ„ä¹‰ä¸‹å–è¡Œåˆ—å¼å¯å¾—ï¼š

$$
\|M_f\|^{\pi(n)}=(-1)^{\pi(n)}=1
$$

äºæ˜¯åœ¨$3\leq n$çš„æ—¶å€™å¿…å®šä¼šæœ‰$\pi(n)$ä¸ºå¶æ•°ã€‚



